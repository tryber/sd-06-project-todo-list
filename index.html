<html>

<head>
  <title>Lista de Tarefas</title>
  <style>
    .selected {
      background-color: rgb(128, 128, 128);
    }

    .completed {
      text-decoration: line-through;
    }
  </style>
</head>

<body>
  <header>
    <h1>Minha Lista de Tarefas</h1>
    <p id="funcionamento">
      Clique duas vezes em um item para marcá-lo como completo.
    </p>
  </header>
  <main>
    <input id="texto-tarefa" type="text" />
    <button id="criar-tarefa">Criar Tarefa</button>

    <ol id="lista-tarefas"></ol>
  </main>
  <footer>
    <button id="apaga-tudo">Apagar Lista</button>
    <button id="remover-finalizados">Remover Finalizados</button>

    <button id="salvar-tarefas">Salvar Tarefas</button>
  </footer>

  <script>
    const listaInput = document.getElementById('texto-tarefa');
    const botaoCriar = document.getElementById('criar-tarefa');
    const listaTarefas = document.getElementById('lista-tarefas');
    const botaoApaga = document.getElementById('apaga-tudo');
    const botaoFinalizados = document.getElementById('remover-finalizados');
    const botaoStorage = document.getElementById('salvar-tarefas');

    function funcionarSelect(item) {
      item.addEventListener('click', function () {
        let lis = document.getElementsByTagName('li'); // todas as lis
        for (let i = 0; i < lis.length; i += 1) {
          lis[i].classList.remove('selected'); // tira de todas
        }
        item.classList.toggle('selected'); // adiciona só na selecionada
      });
    } // LEMBRA de ti

    function funcionarCompleted(item) {
      item.addEventListener('dblclick', function () {
        item.classList.toggle('completed');
      });
    }

    function funcionarInput() {
      botaoCriar.addEventListener('click', function () {
        const criarItem = document.createElement('li');
        listaTarefas.appendChild(criarItem);
        criarItem.innerText = listaInput.value;
        listaInput.value = '';

        funcionarSelect(criarItem);
        funcionarCompleted(criarItem)
      });
    }

    function funcionarBotaoCompleted() {
      botaoFinalizados.addEventListener('click', function () {
        let lis = document.getElementsByTagName('li'); // todas as lis

        let lisLength = lis.length;
        //
        let deleted = [];

        for (let i = 0; i < lisLength; i += 1) {
          if (lis[i].classList.contains('completed')) {
            deleted.push(lis[i]);
          } else {
          }
        }

        for (let i = 0; i < deleted.length; i += 1) {
          deleted[i].remove();
        }
      });
    }

    function funcionarBotaoApaga() {
      botaoApaga.addEventListener('click', function () {
        listaTarefas.innerHTML = '';
      });
    }

    function funcionarBotaoStorage() {
      botaoStorage.addEventListener('click', function () {
        let lis = document.getElementsByTagName('li'); // todas as lis
        localStorage.clear();

        if (lis.length !== 0) { // se tem alguma li criada

          for (let i = 0; i < lis.length; i += 1) {
            localStorage.setItem(i, lis[i].outerHTML);
            // console.log(lis[i])
            // console.log(lis[i].outerHTML)
          }
        }
      });

    }

    //localStorage.clear();

    function LerLocalStorage() {
      let storageLi = document.createElement('li');

      for (let i = 0; i < localStorage.length; i += 1) {
        listaTarefas.appendChild(storageLi);
        storageLi.outerHTML = localStorage[i];
      }
      // recriou tudo, agora adicionar o SELECT e COMPLETED
      let lis = document.getElementsByTagName('li'); // todas as lis

      for (let i = 0; i < lis.length; i += 1) {
        funcionarSelect(lis[i]);
        funcionarCompleted(lis[i]);
      }
    }

    window.onload = function () {
      funcionarInput();
      funcionarBotaoCompleted();
      funcionarBotaoApaga();

      funcionarBotaoStorage();
      LerLocalStorage();
    }
  </script>
</body>

</html>
