<html>

<head>
  <title>Minha Lista de Tarefas</title>

  <style>
    .completed {
      text-decoration: line-through;
    }
  </style>
</head>

<body>
  <header>
    <h1>Minha Lista de Tarefas</h1>
    <p id="funcionamento">Clique duas vezes em um item para marc√°-lo como completo</p>
  </header>
  <section>
    <!-- A lista de tarefas -->
    <input type="text" id="texto-tarefa" />
    <button id="criar-tarefa">Criar Tarefa</button>

    <ol id="lista-tarefas"></ol>
  </section>

  <footer>
    <button id="apaga-tudo">Apagar Lista</button>
    <button id="remover-finalizados">Remover finalizados</button>
  </footer>

  <script type="text/javascript">

    let tarefas = [];
    let listaTarefas = document.getElementById('lista-tarefas');
    let selected;

    let comp = [];

    function rebuildList() {
      for (let i = 0; i < tarefas.length; i += 1) {
        let novaTarefa = document.createElement('li');

        listaTarefas.appendChild(novaTarefa);
        novaTarefa.innerText = tarefas[i];
      }
      if (selected !== undefined) {
        listaTarefas.children[selected].style.backgroundColor = 'rgb(128, 128, 128)';
      }
    }

    function selectTarefa() {
      // funciona pra capacidade de selecionar e de clicar duas vezes
      let listNodes = listaTarefas.children;

      for (let i = 0; i < listNodes.length; i += 1) {

        // pra selecionar
        listNodes[i].addEventListener('click', function () {
          if (selected !== undefined) {
            listNodes[selected].style.removeProperty('background-color');
          }
          selected = i;
          listNodes[i].style.backgroundColor = 'rgb(128, 128, 128)';
        });

        // pra clicar duas vezes
        listNodes[i].addEventListener('dblclick', function () {
          listNodes[i].classList.toggle('completed');
        });
      }
    }

    function addTarefa() {
      let inputTarefa = document.getElementById('texto-tarefa');
      let botaoTarefa = document.getElementById('criar-tarefa');

      botaoTarefa.addEventListener('click', function () {

        if (inputTarefa.value !== '') {
          tarefas.push(inputTarefa.value);
          inputTarefa.value = '';

          listaTarefas.innerHTML = '';
          rebuildList();
          selectTarefa();
        }
      });
    }

    function apagarLista() {
      let botaoApagar = document.getElementById('apaga-tudo');

      botaoApagar.addEventListener('click', function () {
        listaTarefas.innerHTML = '';
        tarefas = [];
      });
    }

    function removerFinalizados() {

      let botaoFinalizados = document.getElementById('remover-finalizados');
      botaoFinalizados.addEventListener('click', function () {
        let listNodes = listaTarefas.children;

        for (let i = 0; i < listNodes.length; i += 1) {
          if (listNodes[i].classList.contains('completed')) {
            tarefas.splice(i, 0);

            if (selected === i) {
              selected = undefined;
            } else if (selected === (listNodes.length - 1)) {
              selected -= 1;
            }
          }
        }

        listaTarefas.innerHTML = '';
        rebuildList();
        selectTarefa();
      });
    }

    // tira depois hein!!!!!
    window.addEventListener('keydown', function (e) {
      if (e.keyCode === 87) {
        console.log(selected);
      }
    });

    window.onload = function () {
      addTarefa();
      apagarLista();
      removerFinalizados();

    }
  </script>
</body>

</html>
